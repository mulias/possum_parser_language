input(dir)

dir =
  Name <- "$ cd " > word < nl &
  Files <- "$ ls" > nl > files < nl &
  Subdirs <- default(child_dirs, []) $
  {"name": Name, "files": Files, "subdirs": Subdirs}

child_dirs = array_until(dir < nl, "$ cd ..")

files = maybe_array_sep(maybe(dir_listings > nl) > file_listing < maybe(nl > dir_listings), nl)

dir_listings = array_sep("dir " > word, nl)

file_listing = Size <- number & ws & Name <- word $ {"name": Name, "size": Size}
